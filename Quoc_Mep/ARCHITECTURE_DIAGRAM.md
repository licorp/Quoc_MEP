# SÆ¡ Ä‘á»“ Kiáº¿n trÃºc - Revit API MEP

## ğŸ“Š Cáº¥u trÃºc Solutions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WORKSPACE: RevitAPIMEP                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ SOLUTION 1   â”‚           â”‚  SOLUTION 2     â”‚
         â”‚ Quoc_MEP     â”‚           â”‚ Schedule        â”‚
         â”‚ _Main.sln    â”‚           â”‚ Manager.sln     â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                           â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ PROJECT      â”‚           â”‚  PROJECT        â”‚
         â”‚ Quoc_MEP     â”‚           â”‚ Schedule        â”‚
         â”‚ .csproj      â”‚           â”‚ Manager.csproj  â”‚
         â”‚              â”‚           â”‚                 â”‚
         â”‚ Old-style    â”‚           â”‚ SDK-style       â”‚
         â”‚ .NET 4.8     â”‚           â”‚ .NET 4.8        â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                           â”‚
                â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                â””â”€â”€â”€â”€â–º RIBBON HOST â—„â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚  (PROJECT)  â”‚
                     â”‚ RibbonHost  â”‚
                     â”‚   .csproj   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                     â”‚   OUTPUT     â”‚
                     â”‚ bin\Release\ â”‚
                     â”‚ Revit2023\   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚             â”‚             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ RibbonHost â”‚   â”‚ Schedule   â”‚  â”‚ Quoc_MEP   â”‚
    â”‚   .dll     â”‚   â”‚ Manager    â”‚  â”‚   .dll     â”‚
    â”‚            â”‚   â”‚   .dll     â”‚  â”‚ (optional) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚            â”‚            â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   REVIT     â”‚
                    â”‚ Tab: Quoc   â”‚
                    â”‚     MEP     â”‚
                    â”‚             â”‚
                    â”‚ Panel: MEP  â”‚
                    â”‚    Tools    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Luá»“ng Build

```
DEVELOPER
    â”‚
    â”œâ”€â”€â”€ LÃ m viá»‡c vá»›i Schedule Manager
    â”‚    â”‚
    â”‚    â””â”€â–º Build ScheduleManager.sln
    â”‚        â”‚
    â”‚        â”œâ”€â–º build-schedule-manager.ps1
    â”‚        â”‚
    â”‚        â””â”€â–º Output: ScheduleManager.dll
    â”‚
    â”œâ”€â”€â”€ LÃ m viá»‡c vá»›i Main Features
    â”‚    â”‚
    â”‚    â””â”€â–º Build Quoc_MEP_Main.sln
    â”‚        â”‚
    â”‚        â””â”€â–º Output: Quoc_MEP.dll
    â”‚
    â””â”€â”€â”€ Update Ribbon Host
         â”‚
         â””â”€â–º Build RibbonHost project
             â”‚
             â”œâ”€â–º build-ribbonhost.ps1
             â”‚
             â””â”€â–º Output: Quoc_MEP.RibbonHost.dll
```

## ğŸ¯ Luá»“ng Runtime trong Revit

```
REVIT STARTS
    â”‚
    â””â”€â–º Äá»c manifest: Quoc_MEP_SharedRibbon.addin
        â”‚
        â””â”€â–º Load: Quoc_MEP.RibbonHost.dll
            â”‚
            â”œâ”€â–º Application.OnStartup()
            â”‚   â”‚
            â”‚   â”œâ”€â–º CreateRibbonTab("Quoc MEP")
            â”‚   â”‚
            â”‚   â”œâ”€â–º CreateRibbonPanel("MEP Tools")
            â”‚   â”‚
            â”‚   â””â”€â–º LoadCommands()
            â”‚       â”‚
            â”‚       â”œâ”€â–º Scan folder: bin\Release\Revit2023\
            â”‚       â”‚
            â”‚       â”œâ”€â–º Find: ScheduleManager.dll
            â”‚       â”‚   â”‚
            â”‚       â”‚   â””â”€â–º Load: ScheduleManagerCommandInfo
            â”‚       â”‚       â”‚
            â”‚       â”‚       â””â”€â–º Create button: "Schedule Manager"
            â”‚       â”‚
            â”‚       â”œâ”€â–º Find: Quoc_MEP.dll (náº¿u cÃ³)
            â”‚       â”‚   â”‚
            â”‚       â”‚   â””â”€â–º Load: ExportCommandInfo, etc.
            â”‚       â”‚       â”‚
            â”‚       â”‚       â””â”€â–º Create buttons: "Export", "Connect"...
            â”‚       â”‚
            â”‚       â””â”€â–º Panel hiá»ƒn thá»‹ táº¥t cáº£ buttons
            â”‚
            â””â”€â–º USER CLICK BUTTON
                â”‚
                â””â”€â–º Execute command tá»« DLL tÆ°Æ¡ng á»©ng
```

## ğŸ—ï¸ Cáº¥u trÃºc Folders

```
RevitAPIMEP/
â”‚
â”œâ”€â”€â”€ ğŸ“ Solutions
â”‚    â”œâ”€â”€â”€ Quoc_MEP_Main.sln          â† CHÃNH
â”‚    â””â”€â”€â”€ ScheduleManager.sln        â† RIÃŠNG
â”‚
â”œâ”€â”€â”€ ğŸ“ Projects
â”‚    â”œâ”€â”€â”€ Quoc_MEP.csproj            â† Old-style
â”‚    â”œâ”€â”€â”€ Quoc_MEP.RibbonHost/       â† Infrastructure
â”‚    â”‚    â””â”€â”€â”€ Quoc_MEP.RibbonHost.csproj
â”‚    â””â”€â”€â”€ ScheduleManager/           â† SDK-style
â”‚         â””â”€â”€â”€ ScheduleManager.csproj
â”‚
â”œâ”€â”€â”€ ğŸ“ Source Code (Solution chÃ­nh)
â”‚    â”œâ”€â”€â”€ App/                        â† Application startup
â”‚    â”œâ”€â”€â”€ Export/                     â† Export features
â”‚    â”œâ”€â”€â”€ Connect/                    â† Connect tools
â”‚    â”œâ”€â”€â”€ DrawPipe/                   â† Draw pipe
â”‚    â”œâ”€â”€â”€ Place Support/              â† Support placement
â”‚    â”œâ”€â”€â”€ Lib/                        â† Shared utilities
â”‚    â””â”€â”€â”€ ... (nhiá»u folders khÃ¡c)
â”‚
â”œâ”€â”€â”€ ğŸ“ Source Code (Schedule Manager)
â”‚    â””â”€â”€â”€ ScheduleManager/
â”‚         â”œâ”€â”€â”€ ScheduleManagerCommand.cs
â”‚         â”œâ”€â”€â”€ ScheduleManagerViewModel.cs
â”‚         â”œâ”€â”€â”€ ScheduleManagerWindow.xaml
â”‚         â”œâ”€â”€â”€ AsyncScheduleReader.cs
â”‚         â””â”€â”€â”€ ... (10 files)
â”‚
â”œâ”€â”€â”€ ğŸ“ Build Scripts
â”‚    â”œâ”€â”€â”€ build-ribbonhost.ps1
â”‚    â””â”€â”€â”€ build-schedule-manager.ps1
â”‚
â”œâ”€â”€â”€ ğŸ“ Output
â”‚    â””â”€â”€â”€ bin/Release/
â”‚         â”œâ”€â”€â”€ Revit2020/
â”‚         â”œâ”€â”€â”€ Revit2021/
â”‚         â”œâ”€â”€â”€ Revit2022/
â”‚         â”œâ”€â”€â”€ Revit2023/            â† CURRENT
â”‚         â”‚    â”œâ”€â”€â”€ Quoc_MEP.RibbonHost.dll
â”‚         â”‚    â”œâ”€â”€â”€ ScheduleManager.dll
â”‚         â”‚    â””â”€â”€â”€ Wpf.Ui.dll
â”‚         â””â”€â”€â”€ Revit2024/
â”‚
â””â”€â”€â”€ ğŸ“ Deployment
     â””â”€â”€â”€ Quoc_MEP_SharedRibbon.addin â†’ Copy to Revit addins
```

## ğŸ’¡ Táº¡i sao cÃ³ 2 Solutions?

### âŒ TRÆ¯á»šC (1 Solution lá»›n):
```
Quoc_MEP.sln
    â”‚
    â””â”€â”€â”€ Quoc_MEP.csproj
         â”œâ”€â”€â”€ Export/         (100+ files)
         â”œâ”€â”€â”€ Connect/        (50+ files)
         â”œâ”€â”€â”€ DrawPipe/       (30+ files)
         â”œâ”€â”€â”€ ScheduleManager/ (10 files)
         â””â”€â”€â”€ ... (hÃ ng ngÃ n files)

Build time: 15-30 giÃ¢y
Sá»­a 1 file Schedule â†’ Pháº£i rebuild Táº¤T Cáº¢
Package issues vá»›i old-style project
```

### âœ… SAU (2 Solutions riÃªng):
```
Quoc_MEP_Main.sln              ScheduleManager.sln
    â”‚                               â”‚
    â””â”€â”€â”€ Quoc_MEP.csproj           â””â”€â”€â”€ ScheduleManager.csproj
         â”œâ”€â”€â”€ Export/                    â”œâ”€â”€â”€ ScheduleManagerCommand.cs
         â”œâ”€â”€â”€ Connect/                   â”œâ”€â”€â”€ ScheduleManagerViewModel.cs
         â”œâ”€â”€â”€ DrawPipe/                  â””â”€â”€â”€ ... (chá»‰ 10 files)
         â””â”€â”€â”€ ...
                                   Build time: 0.6 giÃ¢y âš¡
Build time: 10-20 giÃ¢y           Sá»­a Schedule â†’ Build RIÃŠNG
Chá»‰ build khi cáº§n                SDK-style â†’ Nice3point OK âœ…
```

## ğŸ¯ VÃ­ dá»¥ Workflow thá»±c táº¿

### Scenario 1: Sá»­a bug Schedule Manager
```
1. Má»Ÿ ScheduleManager.sln (khÃ´ng cáº§n má»Ÿ solution chÃ­nh)
2. Sá»­a file ScheduleManagerViewModel.cs
3. Build: .\build-schedule-manager.ps1 -Versions @("2023")
4. Test trong Revit
   âœ… Nhanh: 0.6s build time
   âœ… KhÃ´ng áº£nh hÆ°á»Ÿng code khÃ¡c
```

### Scenario 2: ThÃªm feature Export má»›i
```
1. Má»Ÿ Quoc_MEP_Main.sln
2. ThÃªm code trong Export/
3. Build solution trong Visual Studio
4. Test trong Revit
   âœ… Schedule Manager khÃ´ng bá»‹ rebuild
```

### Scenario 3: Deploy cáº£ 2
```
1. Build RibbonHost: .\build-ribbonhost.ps1
2. Build ScheduleManager: .\build-schedule-manager.ps1
3. Build Quoc_MEP_Main.sln (Visual Studio)
4. Copy manifest file
5. Khá»Ÿi Ä‘á»™ng Revit
   âœ… Táº¥t cáº£ features Ä‘á»u cÃ³ trÃªn 1 panel
```

## ğŸ“ˆ So sÃ¡nh Performance

| Thao tÃ¡c | TrÆ°á»›c (1 Solution) | Sau (2 Solutions) |
|----------|-------------------|-------------------|
| Build Schedule Manager | 15-30s | 0.6s âš¡ |
| Build toÃ n bá»™ | 15-30s | 10-20s (chá»‰ khi cáº§n) |
| Sá»­a 1 file Schedule | Rebuild Táº¤T Cáº¢ | Rebuild Schedule only |
| Nice3point packages | âŒ KhÃ´ng hoáº¡t Ä‘á»™ng | âœ… Hoáº¡t Ä‘á»™ng tá»‘t |
| Test Ä‘á»™c láº­p | âŒ KhÃ³ | âœ… Dá»… dÃ ng |

---

**Káº¿t luáº­n**: 
- **Quoc_MEP_Main.sln** = Solution CHÃNH cho táº¥t cáº£ features
- **ScheduleManager.sln** = Solution RIÃŠNG cho Schedule Manager
- **RibbonHost** = Gom cáº£ 2 láº¡i thÃ nh 1 ribbon panel

âœ… Build nhanh hÆ¡n  
âœ… Dá»… maintain  
âœ… Package management tá»‘t hÆ¡n  
âœ… Test Ä‘á»™c láº­p Ä‘Æ°á»£c  
