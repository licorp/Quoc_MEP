<![CDATA[<ui:FluentWindow x:Class="ScheduleManager.ScheduleManagerWindow"<ui:FluentWindow x:Class="ScheduleManager.ScheduleManagerWindow"<Window x:Class="ScheduleManager.ScheduleManagerWindow"

        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"

        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"

        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"

        xmlns:dgx="urn:tom-englert.de/DataGridExtensions"        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"

        Title="Schedule Manager - Quoc MEP" 

        Height="700" Width="1200"        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"

        WindowStartupLocation="CenterScreen"

        Background="{DynamicResource ApplicationBackgroundBrush}"        xmlns:local="clr-namespace:ScheduleManager"        Title="Schedule Manager" 

        ExtendsContentIntoTitleBar="True"

        WindowBackdropType="Mica">        Title="Schedule Manager - Modern Edition"         Height="700" Width="1200"



    <Grid>        Height="700" Width="1200"        WindowStartupLocation="CenterScreen"

        <Grid.RowDefinitions>

            <RowDefinition Height="Auto"/>        WindowStartupLocation="CenterScreen"        Background="{DynamicResource ApplicationBackgroundBrush}">

            <RowDefinition Height="Auto"/>

            <RowDefinition Height="*"/>        WindowBackdropType="Mica"

            <RowDefinition Height="Auto"/>

        </Grid.RowDefinitions>        ExtendsContentIntoTitleBar="True"    <Window.Resources>



        <!-- Title Bar -->        ResizeMode="CanResize">        <!-- Converter for boolean to visibility -->

        <ui:TitleBar Grid.Row="0" Title="Schedule Manager" Icon="pack://application:,,,/ScheduleManager;component/icons8-edit-property-windows-10.png"/>

            <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- Toolbar -->

        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="10,10,10,5" Background="{DynamicResource ControlFillColorDefaultBrush}">    <Grid Margin="10">        

            <ui:Button Content="üìÇ Load Schedules" 

                       Command="{Binding LoadSchedulesCommand}"        <Grid.RowDefinitions>        <!-- Status bar background -->

                       Margin="5" Padding="15,8"

                       ToolTip="Load all schedules from current Revit document"/>            <RowDefinition Height="Auto"/>        <SolidColorBrush x:Key="StatusBarBackground" Color="#F5F5F5"/>

            

            <ui:Button Content="üíæ Export to Excel"             <RowDefinition Height="Auto"/>    </Window.Resources>

                       Command="{Binding ExportToExcelCommand}"

                       Margin="5" Padding="15,8"            <RowDefinition Height="*"/>

                       ToolTip="Export schedule data to Excel file (.xlsx)"/>

                        <RowDefinition Height="Auto"/>    <Grid>

            <ui:Button Content="üì• Import from Excel" 

                       Command="{Binding ImportFromExcelCommand}"        </Grid.RowDefinitions>        <Grid.RowDefinitions>

                       Margin="5" Padding="15,8"

                       ToolTip="Import data from Excel and update Revit schedules"/>                    <RowDefinition Height="Auto"/> <!-- Toolbar -->

            

            <ui:Button Content="üîÑ Refresh"         <!-- Header with Schedule Selection -->            <RowDefinition Height="*"/>    <!-- Content -->

                       Command="{Binding RefreshCommand}"

                       Margin="5" Padding="15,8"        <ui:Card Grid.Row="0" Margin="0,0,0,10">            <RowDefinition Height="Auto"/> <!-- Status bar -->

                       ToolTip="Refresh schedule data"/>

                        <StackPanel>        </Grid.RowDefinitions>

            <Separator Margin="10,5" Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}"/>

                            <TextBlock Text="üìã Select Schedule" 

            <TextBlock Text="üìã Total Schedules:" VerticalAlignment="Center" Margin="5,0"/>

            <TextBlock Text="{Binding TotalSchedules}" FontWeight="Bold" VerticalAlignment="Center" Margin="5,0" Foreground="{DynamicResource AccentTextFillColorPrimaryBrush}"/>                          FontSize="16"         <!-- Toolbar -->

            

            <TextBlock Text="| üìÑ Rows:" VerticalAlignment="Center" Margin="15,0,5,0"/>                          FontWeight="SemiBold"         <Border Grid.Row="0" 

            <TextBlock Text="{Binding TotalRows}" FontWeight="Bold" VerticalAlignment="Center" Margin="5,0" Foreground="{DynamicResource AccentTextFillColorPrimaryBrush}"/>

        </StackPanel>                          Margin="0,0,0,10"/>                Background="{DynamicResource ControlFillColorDefaultBrush}"



        <!-- DataGrid with Search/Filter -->                                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"

        <DataGrid Grid.Row="2" 

                  ItemsSource="{Binding ScheduleRows}"                <Grid>                BorderThickness="0,0,0,1"

                  AutoGenerateColumns="False"

                  CanUserAddRows="False"                    <Grid.ColumnDefinitions>                Padding="10">

                  CanUserDeleteRows="False"

                  SelectionMode="Extended"                        <ColumnDefinition Width="*"/>            <WrapPanel>

                  SelectionUnit="FullRow"

                  EnableRowVirtualization="True"                        <ColumnDefinition Width="Auto"/>                <ui:Button Content="Load Schedule" 

                  EnableColumnVirtualization="True"

                  VirtualizingPanel.IsVirtualizing="True"                        <ColumnDefinition Width="Auto"/>                          Command="{Binding LoadScheduleCommand}"

                  VirtualizingPanel.VirtualizationMode="Recycling"

                  dgx:DataGridFilter.IsAutoFilterEnabled="True"                    </Grid.ColumnDefinitions>                          Icon="{ui:SymbolIcon DocumentArrowDown24}"

                  Margin="10,5,10,5"

                  Background="{DynamicResource ControlFillColorDefaultBrush}"                                              Appearance="Primary"

                  BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"

                  BorderThickness="1">                    <ComboBox Grid.Column="0"                          Margin="0,0,10,0"/>

            

            <DataGrid.Columns>                             ItemsSource="{Binding Schedules}"

                <DataGridTextColumn Header="Schedule Name" 

                                    Binding="{Binding ScheduleName}"                              SelectedItem="{Binding SelectedSchedule}"                <ui:Button Content="Cancel" 

                                    Width="250"

                                    IsReadOnly="True"                             DisplayMemberPath="Name"                          Command="{Binding CancelLoadCommand}"

                                    dgx:DataGridFilterColumn.Template="{DynamicResource {x:Static dgx:DataGridFilter.TextColumnFilterTemplateKey}}"/>

                                             Margin="0,0,10,0"/>                          Icon="{ui:SymbolIcon Dismiss24}"

                <DataGridTextColumn Header="Element ID" 

                                    Binding="{Binding ElementId}"                                               Appearance="Secondary"

                                    Width="100"

                                    IsReadOnly="True"                    <ui:Button Grid.Column="1"                          Margin="0,0,10,0"

                                    dgx:DataGridFilterColumn.Template="{DynamicResource {x:Static dgx:DataGridFilter.TextColumnFilterTemplateKey}}"/>

                                              Content="üîÑ Refresh"                          Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"/>

                <DataGridTextColumn Header="Field Name" 

                                    Binding="{Binding FieldName}"                               Command="{Binding RefreshCommand}"

                                    Width="200"

                                    IsReadOnly="True"                              Margin="0,0,10,0"                <Separator Width="1" 

                                    dgx:DataGridFilterColumn.Template="{DynamicResource {x:Static dgx:DataGridFilter.TextColumnFilterTemplateKey}}"/>

                                              Appearance="Secondary"/>                          Height="32" 

                <DataGridTextColumn Header="Value" 

                                    Binding="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"                                               Margin="5,0"

                                    Width="*"

                                    dgx:DataGridFilterColumn.Template="{DynamicResource {x:Static dgx:DataGridFilter.TextColumnFilterTemplateKey}}"/>                    <ui:Button Grid.Column="2"                          Background="{DynamicResource ControlStrokeColorDefaultBrush}"/>

                

                <DataGridTextColumn Header="Row Index"                               Content="üì• Load Data"

                                    Binding="{Binding RowIndex}" 

                                    Width="80"                              Command="{Binding LoadScheduleCommand}"                <ui:Button Content="Update Model" 

                                    IsReadOnly="True"/>

                                              Appearance="Primary"/>                          Command="{Binding UpdateModelCommand}"

                <DataGridTextColumn Header="Column Index" 

                                    Binding="{Binding ColumnIndex}"                 </Grid>                          Icon="{ui:SymbolIcon ArrowSync24}"

                                    Width="100"

                                    IsReadOnly="True"/>            </StackPanel>                          Appearance="Success"

            </DataGrid.Columns>

                    </ui:Card>                          Margin="5,0,10,0"/>

            <DataGrid.RowStyle>

                <Style TargetType="DataGridRow">        

                    <Style.Triggers>

                        <DataTrigger Binding="{Binding IsModified}" Value="True">        <!-- Search and Stats Bar -->                <ui:Button Content="Select Modified" 

                            <Setter Property="Background" Value="#FFFFEB3B"/>

                            <Setter Property="FontWeight" Value="Bold"/>        <ui:Card Grid.Row="1" Margin="0,0,0,10">                          Command="{Binding SelectElementsCommand}"

                        </DataTrigger>

                    </Style.Triggers>            <Grid>                          Icon="{ui:SymbolIcon CheckboxChecked24}"

                </Style>

            </DataGrid.RowStyle>                <Grid.ColumnDefinitions>                          Margin="0,0,10,0"/>

        </DataGrid>

                    <ColumnDefinition Width="*"/>

        <!-- Status Bar -->

        <StatusBar Grid.Row="3" Background="{DynamicResource ControlFillColorDefaultBrush}">                    <ColumnDefinition Width="Auto"/>                <ui:Button Content="Zoom To" 

            <StatusBarItem>

                <TextBlock Text="{Binding StatusMessage}" Margin="5,0"/>                </Grid.ColumnDefinitions>                          Command="{Binding ZoomToElementsCommand}"

            </StatusBarItem>

            <Separator/>                                          Icon="{ui:SymbolIcon ZoomIn24}"

            <StatusBarItem>

                <TextBlock Text="{Binding DocumentName}" FontWeight="Bold" Margin="5,0"/>                <ui:TextBox Grid.Column="0"                          Margin="0,0,10,0"/>

            </StatusBarItem>

            <Separator/>                           PlaceholderText="üîç Search in schedule..."

            <StatusBarItem HorizontalAlignment="Right">

                <StackPanel Orientation="Horizontal">                           Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"                <Separator Width="1" 

                    <ui:ProgressRing IsIndeterminate="True" 

                                     Width="16" Height="16"                            ClearButtonEnabled="True"                          Height="32" 

                                     Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"

                                     Margin="0,0,5,0"/>                           Margin="0,0,10,0"/>                          Margin="5,0"

                    <TextBlock Text="{Binding LoadingMessage}" Margin="5,0"/>

                </StackPanel>                                          Background="{DynamicResource ControlStrokeColorDefaultBrush}"/>

            </StatusBarItem>

        </StatusBar>                <StackPanel Grid.Column="1" Orientation="Horizontal">

    </Grid>

</ui:FluentWindow>                    <TextBlock Text="{Binding VisibleRows, StringFormat='Showing {0}'}"                 <ui:Button Content="Export to Excel" 

]]>
                              VerticalAlignment="Center"                          Command="{Binding ExportCommand}"

                              Margin="0,0,5,0"/>                          Icon="{ui:SymbolIcon DocumentTableArrowRight24}"

                    <TextBlock Text="/"                           Margin="5,0,0,0"/>

                              VerticalAlignment="Center"            </WrapPanel>

                              Margin="0,0,5,0"/>        </Border>

                    <TextBlock Text="{Binding TotalRows, StringFormat='{0} rows'}" 

                              VerticalAlignment="Center"/>        <!-- Content Area -->

                </StackPanel>        <Grid Grid.Row="1" Margin="10">

            </Grid>            <!-- Loading overlay -->

        </ui:Card>            <Grid Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"

                          Background="#80FFFFFF"

        <!-- DataGrid with Modern Design -->                  Panel.ZIndex="999">

        <ui:Card Grid.Row="2">                <StackPanel HorizontalAlignment="Center" 

            <Grid>                           VerticalAlignment="Center">

                <!-- Loading Overlay -->                    <ui:ProgressRing IsIndeterminate="True" 

                <Grid x:Name="LoadingOverlay"                                     Width="60" 

                      Background="#DD000000"                                    Height="60"/>

                      Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">                    <TextBlock Text="{Binding StatusText}" 

                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">                              FontSize="14"

                        <ui:ProgressRing IsIndeterminate="True" Width="60" Height="60"/>                              Margin="0,10,0,0"

                        <TextBlock Text="{Binding LoadingMessage}"                               HorizontalAlignment="Center"/>

                                  Foreground="White"                    <ProgressBar Value="{Binding ProgressValue}" 

                                  FontSize="14"                                Maximum="100"

                                  Margin="0,20,0,0"                                Width="200"

                                  HorizontalAlignment="Center"/>                                Height="4"

                        <ui:Button Content="Cancel"                                 Margin="0,10,0,0"/>

                                  Command="{Binding CancelCommand}"                </StackPanel>

                                  Margin="0,10,0,0"            </Grid>

                                  Appearance="Danger"/>

                    </StackPanel>            <!-- Data Grid -->

                </Grid>            <DataGrid ItemsSource="{Binding ScheduleRows}"

                                     AutoGenerateColumns="False"

                <!-- DataGrid -->                     CanUserAddRows="False"

                <DataGrid x:Name="ScheduleDataGrid"                     CanUserDeleteRows="False"

                         ItemsSource="{Binding ScheduleDataView}"                     SelectionMode="Extended"

                         AutoGenerateColumns="True"                     GridLinesVisibility="All"

                         CanUserAddRows="False"                     AlternatingRowBackground="#F9F9F9"

                         CanUserDeleteRows="False"                     RowHeight="28"

                         CanUserSortColumns="True"                     EnableRowVirtualization="True"

                         SelectionMode="Extended"                     EnableColumnVirtualization="True"

                         GridLinesVisibility="All"                     VirtualizingPanel.IsVirtualizing="True"

                         AlternatingRowBackground="#F5F5F5"                     VirtualizingPanel.VirtualizationMode="Recycling">

                         RowHeight="32"

                         HeadersVisibility="Column"                <!-- Column headers will be generated dynamically -->

                         EnableColumnVirtualization="True"                <!-- For now, showing basic layout -->

                         EnableRowVirtualization="True"                <DataGrid.Columns>

                         VirtualizingPanel.IsVirtualizing="True"                    <DataGridTextColumn Header="Element ID" 

                         VirtualizingPanel.VirtualizationMode="Recycling">                                       Binding="{Binding ElementId}" 

                                                           Width="100"

                    <DataGrid.Resources>                                       IsReadOnly="True"/>

                        <Style TargetType="DataGridColumnHeader">                    <DataGridTextColumn Header="Is Modified" 

                            <Setter Property="Background" Value="#2196F3"/>                                       Binding="{Binding IsModified}" 

                            <Setter Property="Foreground" Value="White"/>                                       Width="100"

                            <Setter Property="FontWeight" Value="SemiBold"/>                                       IsReadOnly="True"/>

                            <Setter Property="Padding" Value="10,8"/>                    <!-- Additional columns will be added programmatically based on ColumnHeaders -->

                            <Setter Property="BorderBrush" Value="#1976D2"/>                </DataGrid.Columns>

                            <Setter Property="BorderThickness" Value="0,0,1,0"/>

                        </Style>                <DataGrid.RowStyle>

                                            <Style TargetType="DataGridRow">

                        <Style TargetType="DataGridCell">                        <Style.Triggers>

                            <Setter Property="Padding" Value="8,4"/>                            <DataTrigger Binding="{Binding IsModified}" Value="True">

                            <Setter Property="BorderBrush" Value="#E0E0E0"/>                                <Setter Property="Background" Value="#FFF9E6"/>

                            <Style.Triggers>                                <Setter Property="FontWeight" Value="SemiBold"/>

                                <Trigger Property="IsSelected" Value="True">                            </DataTrigger>

                                    <Setter Property="Background" Value="#BBDEFB"/>                        </Style.Triggers>

                                    <Setter Property="Foreground" Value="Black"/>                    </Style>

                                </Trigger>                </DataGrid.RowStyle>

                            </Style.Triggers>            </DataGrid>

                        </Style>        </Grid>

                    </DataGrid.Resources>

                </DataGrid>        <!-- Status Bar -->

            </Grid>        <Border Grid.Row="2" 

        </ui:Card>                Background="{StaticResource StatusBarBackground}"

                        BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"

        <!-- Action Buttons -->                BorderThickness="0,1,0,0"

        <ui:Card Grid.Row="3" Margin="0,10,0,0">                Padding="10,5">

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">            <Grid>

                <ui:Button Content="üì§ Export to Excel"                <Grid.ColumnDefinitions>

                          Command="{Binding ExportToExcelCommand}"                    <ColumnDefinition Width="*"/>

                          Appearance="Secondary"                    <ColumnDefinition Width="Auto"/>

                          Margin="0,0,10,0"/>                </Grid.ColumnDefinitions>

                

                <ui:Button Content="üì• Import from Excel"                <TextBlock Grid.Column="0" 

                          Command="{Binding ImportFromExcelCommand}"                          Text="{Binding StatusText}"

                          Appearance="Secondary"                          VerticalAlignment="Center"/>

                          Margin="0,0,10,0"/>

                                <StackPanel Grid.Column="1" 

                <ui:Button Content="üíæ Update Revit"                           Orientation="Horizontal">

                          Command="{Binding UpdateRevitCommand}"                    <TextBlock VerticalAlignment="Center" Margin="0,0,15,0">

                          Appearance="Success"                        <Run Text="Total: "/>

                          Margin="0,0,10,0"/>                        <Run Text="{Binding TotalElements}" FontWeight="SemiBold"/>

                                    </TextBlock>

                <ui:Button Content="‚ùå Close"

                          Click="CloseButton_Click"                    <TextBlock VerticalAlignment="Center">

                          Appearance="Danger"/>                        <Run Text="Modified: "/>

            </StackPanel>                        <Run Text="{Binding ModifiedCount}" 

        </ui:Card>                             FontWeight="SemiBold"

    </Grid>                             Foreground="OrangeRed"/>

</ui:FluentWindow>                    </TextBlock>

                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
